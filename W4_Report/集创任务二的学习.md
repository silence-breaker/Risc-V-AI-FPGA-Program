### 任务二具体内容
FPAI 平台凭借 FPGA 的可编程特性，可灵活适应多源传感器接口并高效完成数据采集与预处理。例如，当智能算法的前后处理算子在 CPU 上实现效率低时，可通过 FPGA 进行定制化加速实现。所谓 “自定义硬算子” 是通过 FPGA 对某个计算模块进行电路加速实现，复旦微电子针对目标感知领域的需求，研发了目标检测阈值筛（DetPost）、语义分割后处理（SegPost）和非极大值抑制（NMS）等自定义硬算子模块，实现了智能算法的全流程硬件加速，显著提高了计算效率，在多领域项目中实现大规模落地应用。

本任务要求参赛者充分发挥 FPAI 平台的可编程特性，基于 30TAI 平台的可编程逻辑资源（Programmable Logic, PL），设计并实现一个自定义硬算子模块，并和 CPU、NPU 协同工作，完成一个智能算法的部署。

---
#### 任务二指标要求

1. 基于 30TAI 平台的可编程逻辑资源，设计并实现一个自定义硬算子模块。该自定义硬算子为智能算法全流程计算中的一环，包括但不限于以下几种场景，图像拼接融合模块、图像滑窗切图模块、图像缩放模块（任意倍数）、图像 ISP 模块、音频预处理模块、图像格式转换模块、求取连通域模块、特殊算子等。
2. 在 30TAI 平台上，结合自定义硬算子模块，CPU 和 NPU，协同实现至少一种智能算法的部署。其中，CPU 可用于承担部分计算和调度控制任务，NPU 需用于承担矩阵乘 / 卷积等 AI 计算任务，自定义硬算子模块需用于承担前后处理，数据采集或特殊算子等任务。
3. 自定义硬算子功能要具备正确性与完整性，要求自定义硬算子能够实现预期功能并能够配合其他计算单元协同完成智能算法全流程部署运行。
4. 自定义硬算子的性能要满足落地应用需求，要求合理设计、提高硬件资源利用率，尽可能达到最优性能。
    报告中要分析电路实现相比于 CPU 实现的效率提升以及 FPGA 资源占用情况。
---
#### 补充说明

针对任务二，命题企业会提供一个 FPGA 示例工程，集成 AI_MATE_IP，包括基础接口和互联模块等；配套提供软件端硬件控制和数据传输的驱动函数。参赛者只需要按照接口要求，完成自定义硬算子模块的设计，以及处理系统中的应用程序即可。

芯片内部架构如下图所示：
![[Pasted image 20260228232656.png]]

### 与我们所做大创的关联点

二者均围绕**FPGA 硬件加速、异构计算、软硬协同设计、智能算法端侧部署**四大核心展开。

#### 知识关联性
1. **FPGA IP 核使用与系统集成**
	集创赛命题企业提供 AI_MATE_IP、基础接口 / 互联模块，
	大创需使用 Xilinx AXI DMA、AXI Interconnect、Zynq PS 核等 IP；
	二者均要求掌握**IP 核实例化、接口适配、时钟 / 复位域规划、硬件资源约束**等技能。
2. **AXI 总线协议**
	集创赛的硬算子需与 CPU/NPU 通过平台总线协同，
	大创的 RISC-V/TDPU 与 DDR、PS 端的通信基于**AXI-Lite/AXI4/AXI4-Stream/AXI HP**，
	均要求深入理解 AXI 总线的读写机制、数据交互流程、DMA 直接存储器访问原理。
3. **FPGA 板级验证**
	二者均需完成硬件模块的**仿真验证（Verilator/Modelsim）、板级联调、数据通路测试**，要求掌握串口 / 网口通信、硬件调试工具（Vivado Logic Analyzer）、外设驱动适配。

#### 题目要求关联性
1. **低比特量化与硬件简化**：大创的核心是 1.58-bit 三值量化（将乘法转为选择 - 累加），集创赛的硬算子设计可借鉴**低比特量化的硬件优化思路**（如将图像数据的高比特运算转为低比特，降低 FPGA 资源占用），二者均需掌握**量化算法的硬件实现、数值精度与硬件资源的权衡**。
2. 集创赛要求**FPGA 硬算子 + CPU+NPU**三级协同（CPU 调度、NPU 做矩阵 / 卷积、FPGA 做前后处理 / 特殊算子）；
	大创要求**RISC-V 软核 + TDPU 三值加速器 + ARM PS 核**三级协同（RISC-V 调度 / KV Cache 管理、TDPU 做 1.58-bit 矩阵乘、ARM 做上电加载 / 外设控制），二者均需掌握**计算任务的分层拆解、不同计算单元的功能分工、数据交互的低延迟设计**。

#### 可以同时推进的学习
1. 开发**1.58-bit 三值矩阵加速单元（TDPU）**，实现无乘法器的选择 - 累加逻辑、并行解包器、AXI4-Stream 接口封装；同时开发**RISC-V 软核的 AXI-Lite 主控接口**，实现对 TDPU 的低延迟触发。
	将大创的**TDPU 作为核心自定义硬算子**，直接适配 30TAI 平台的 AXI 总线接口。
2. 集成 Xilinx AXI DMA、AXI Interconnect、Zynq PS 核，实现 PL 端（RISC-V/TDPU）与 PS 端（DDR）的高速通信；完成时钟 / 复位域规划，处理跨时钟域同步问题。
	复用大创的**IP 核集成方法、时钟 / 复位设计经验**，快速集成命题企业提供的 AI_MATE_IP、基础互联模块，完成 30TAI 平台的 FPGA 硬件基础架构搭建；同时复用大创的**DMA 数据传输逻辑**，实现 FPGA 硬算子与 CPU/NPU 的大数据量流式传输。
3. 数据交互协议应用：将智能算法拆解为**FPGA 硬算子（TDPU / 图像算子：密集并行计算 / 前后处理）、NPU（矩阵乘 / 卷积：传统 AI 密集计算）、CPU（调度控制 / 轻量计算 / KV Cache 管理）**，完全匹配集创赛 “CPU/NPU/FPGA 协同” 的要求；
	同时应用大创的**数据交互协议**，设计 FPGA 与 CPU/NPU 的通信规则。
4. 应用大创的**异构存储设计思路**，在 30TAI 平台上实现**FPGA 硬算子与 CPU/NPU 的内存共享**，通过 DMA 完成 FPGA 与系统内存的数据传输；
	同时应用大创的**KV Cache 管理机制**，优化集创赛智能算法的访存密集型任务（如图像滑窗、语义分割后处理）。
5. 大创的驱动程序可以为集创赛提供**成熟的代码模板**，仅需适配 30TAI 平台的寄存器地址 / 接口协议，减少开发时间。
6. 测试 TDPU/RISC-V 的 LUT/FF/BRAM/DSP 资源占用，通过**资源共享、流水线插入、逻辑优化**减少资源消耗；验证 “无乘法器” 设计的 DSP 零占用优势。
	应用大创的**FPGA 资源分析方法、优化技巧**，测试自定义硬算子的资源占用，满足集创赛 “提高硬件资源利用率” 的要求；同时将大创的**无乘法器设计思路**应用到集创赛硬算子中，减少 DSP 占用，提升平台算力密度。